# terraform-text-generation-inference-aws

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

## Requirements

| Name                                                                     | Version |
| ------------------------------------------------------------------------ | ------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | >= 1.0  |
| <a name="requirement_aws"></a> [aws](#requirement_aws)                   | ~> 5.0  |
| <a name="requirement_time"></a> [time](#requirement_time)                | 0.11.1  |

## Providers

| Name                                                | Version |
| --------------------------------------------------- | ------- |
| <a name="provider_aws"></a> [aws](#provider_aws)    | ~> 5.0  |
| <a name="provider_time"></a> [time](#provider_time) | 0.11.1  |

## Modules

| Name                                                                          | Source                                         | Version |
| ----------------------------------------------------------------------------- | ---------------------------------------------- | ------- |
| <a name="module_acm"></a> [acm](#module_acm)                                  | terraform-aws-modules/acm/aws                  | 5.0.0   |
| <a name="module_alb"></a> [alb](#module_alb)                                  | terraform-aws-modules/alb/aws                  | 9.1.0   |
| <a name="module_autoscaling"></a> [autoscaling](#module_autoscaling)          | terraform-aws-modules/autoscaling/aws          | ~> 6.5  |
| <a name="module_autoscaling_sg"></a> [autoscaling_sg](#module_autoscaling_sg) | terraform-aws-modules/security-group/aws       | ~> 5.0  |
| <a name="module_ecs_cluster"></a> [ecs_cluster](#module_ecs_cluster)          | terraform-aws-modules/ecs/aws//modules/cluster | 5.11.0  |
| <a name="module_ecs_service"></a> [ecs_service](#module_ecs_service)          | terraform-aws-modules/ecs/aws//modules/service | 5.11.0  |
| <a name="module_efs"></a> [efs](#module_efs)                                  | terraform-aws-modules/efs/aws                  | 1.3.1   |

## Resources

| Name                                                                                                                                         | Type        |
| -------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [time_static.activation_date](https://registry.terraform.io/providers/hashicorp/time/0.11.1/docs/resources/static)                           | resource    |
| [aws_ec2_instance_type.cluster_autoscaler](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ec2_instance_type) | data source |
| [aws_ssm_parameter.ecs_optimized_ami](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ssm_parameter)          | data source |

## Inputs

| Name                                                                                                                                 | Description                                                                                                                                                                                                                                                                                     | Type           | Default                                                                                      | Required |
| ------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- | -------------------------------------------------------------------------------------------- | :------: |
| <a name="input_alb"></a> [alb](#input_alb)                                                                                           | Map of values passed to ALB module definition. See the [ALB module](https://github.com/terraform-aws-modules/terraform-aws-alb) for full list of supported arguments                                                                                                                            | `any`          | `{}`                                                                                         |    no    |
| <a name="input_alb_https_default_action"></a> [alb_https_default_action](#input_alb_https_default_action)                            | Default action for ALB HTTPS listener                                                                                                                                                                                                                                                           | `any`          | <pre>{<br> "forward": {<br> "target_group_key": "text_generation_inference"<br> }<br>}</pre> |    no    |
| <a name="input_alb_security_group_id"></a> [alb_security_group_id](#input_alb_security_group_id)                                     | ID of an existing security group to attach to the ALB. Required if `create_alb` is `false`                                                                                                                                                                                                      | `string`       | `""`                                                                                         |    no    |
| <a name="input_alb_subnets"></a> [alb_subnets](#input_alb_subnets)                                                                   | A list of subnets in which the ALB will be deployed. Required if `create_alb` is `true`                                                                                                                                                                                                         | `list(string)` | `[]`                                                                                         |    no    |
| <a name="input_alb_target_group_arn"></a> [alb_target_group_arn](#input_alb_target_group_arn)                                        | ARN of an existing ALB target group that will be used to route traffic to the Text Generation Inference service. Required if `create_alb` is `false`                                                                                                                                            | `string`       | `""`                                                                                         |    no    |
| <a name="input_autoscaling"></a> [autoscaling](#input_autoscaling)                                                                   | Map of values passed to ECS autoscaling module definition. See the [ECS autoscaling module](https://github.com/terraform-aws-modules/terraform-aws-autoscaling) for full list of arguments supported                                                                                            | `any`          | `{}`                                                                                         |    no    |
| <a name="input_certificate_arn"></a> [certificate_arn](#input_certificate_arn)                                                       | ARN of an existing ACM certificate to use with the ALB. If not provided, a new certificate will be created. Required if `create_alb` is `true` and `create_certificate` is `false`                                                                                                              | `string`       | `""`                                                                                         |    no    |
| <a name="input_certificate_domain_name"></a> [certificate_domain_name](#input_certificate_domain_name)                               | Route53 domain name to use for ACM certificate. Route53 zone for this domain should be created in advance.                                                                                                                                                                                      | `string`       | `""`                                                                                         |    no    |
| <a name="input_cluster"></a> [cluster](#input_cluster)                                                                               | Map of values passed to ECS cluster module definition. See the [ECS cluster module](https://github.com/terraform-aws-modules/terraform-aws-ecs/tree/master/modules/cluster) for full list of supported arguments                                                                                | `any`          | `{}`                                                                                         |    no    |
| <a name="input_cluster_agent_log_level"></a> [cluster_agent_log_level](#input_cluster_agent_log_level)                               | Log level for ECS cluster agent                                                                                                                                                                                                                                                                 | `string`       | `"info"`                                                                                     |    no    |
| <a name="input_cluster_arn"></a> [cluster_arn](#input_cluster_arn)                                                                   | ARN of the ECS cluster in which the service will be deployed. Required if create_cluster is false                                                                                                                                                                                               | `string`       | `null`                                                                                       |    no    |
| <a name="input_create_alb"></a> [create_alb](#input_create_alb)                                                                      | Determines whether to create an Application Load Balancer for the ECS service                                                                                                                                                                                                                   | `bool`         | `true`                                                                                       |    no    |
| <a name="input_create_certificate"></a> [create_certificate](#input_create_certificate)                                              | Determines whether to create an ACM certificate for the ALB                                                                                                                                                                                                                                     | `bool`         | `true`                                                                                       |    no    |
| <a name="input_create_cluster"></a> [create_cluster](#input_create_cluster)                                                          | Determines whether to create an ECS cluster for the service                                                                                                                                                                                                                                     | `bool`         | `true`                                                                                       |    no    |
| <a name="input_create_route53_records"></a> [create_route53_records](#input_create_route53_records)                                  | Determines whether to create Route53 records for the ALB                                                                                                                                                                                                                                        | `bool`         | `true`                                                                                       |    no    |
| <a name="input_dtype"></a> [dtype](#input_dtype)                                                                                     | Data type to use for model weights. The default is to use the default data type for the model. This is not compatible with quantization                                                                                                                                                         | `string`       | `null`                                                                                       |    no    |
| <a name="input_efs"></a> [efs](#input_efs)                                                                                           | Map of values passed to EFS module definition. See the [EFS module](https://github.com/terraform-aws-modules/terraform-aws-efs) for full list of arguments supported                                                                                                                            | `any`          | `{}`                                                                                         |    no    |
| <a name="input_enable_efs"></a> [enable_efs](#input_enable_efs)                                                                      | Determines whether to create an EFS volume for the ECS service, this is used for model storage if enabled                                                                                                                                                                                       | `bool`         | `false`                                                                                      |    no    |
| <a name="input_hugging_face_hub_token"></a> [hugging_face_hub_token](#input_hugging_face_hub_token)                                  | Hugging Face Hub API token                                                                                                                                                                                                                                                                      | `string`       | `""`                                                                                         |    no    |
| <a name="input_init_nginx"></a> [init_nginx](#input_init_nginx)                                                                      | Map of values passed to nginx init container definition. See the [ECS container definition module](https://github.com/terraform-aws-modules/terraform-aws-ecs/tree/master/modules/container-definition) for full list of arguments supported                                                    | `any`          | `{}`                                                                                         |    no    |
| <a name="input_instance_type"></a> [instance_type](#input_instance_type)                                                             | Instance type to use for ECS autoscaling group, note that currently only g4dn.\* instance types are supported. When using > 7B models, be sure to select an instance type that has at least 20GB of RAM for initial loading unless using a non-default QUANTIZE setting which reduces RAM usage | `string`       | `"g4dn.xlarge"`                                                                              |    no    |
| <a name="input_model_name"></a> [model_name](#input_model_name)                                                                      | The name of the model to load. Can be a MODEL_ID as listed on <https://hf.co/models> like `gpt2` or `OpenAssistant/oasst-sft-1-pythia-12b`. Or it can be a local directory containing the necessary files as saved by `save_pretrained(...)` methods of transformers                            | `string`       | `"teknium/OpenHermes-2.5-Mistral-7B"`                                                        |    no    |
| <a name="input_name"></a> [name](#input_name)                                                                                        | Common name to use on all resources                                                                                                                                                                                                                                                             | `string`       | `"text_generation_inference"`                                                                |    no    |
| <a name="input_nginx"></a> [nginx](#input_nginx)                                                                                     | Map of values passed to nginx container definition. See the [ECS container definition module](https://github.com/terraform-aws-modules/terraform-aws-ecs/tree/master/modules/container-definition) for full list of arguments supported                                                         | `any`          | `{}`                                                                                         |    no    |
| <a name="input_quantize"></a> [quantize](#input_quantize)                                                                            | Quantize the model to reduce memory usage. This can be useful for large models that don't fit in memory. The default is to not quantize the model                                                                                                                                               | `string`       | `null`                                                                                       |    no    |
| <a name="input_route53_record_name"></a> [route53_record_name](#input_route53_record_name)                                           | Name of Route53 record to create ACM certificate in and main A-record. If not specified var.name will be used. Required if create_route53_records is true                                                                                                                                       | `string`       | `null`                                                                                       |    no    |
| <a name="input_route53_zone_id"></a> [route53_zone_id](#input_route53_zone_id)                                                       | ID of the Route53 zone in which to create records. Required if create_route53_records is true                                                                                                                                                                                                   | `string`       | `""`                                                                                         |    no    |
| <a name="input_service"></a> [service](#input_service)                                                                               | Map of values passed to ECS service module definition. See the [ECS service module](https://github.com/terraform-aws-modules/terraform-aws-ecs/tree/master/modules/service) for full list of arguments supported                                                                                | `any`          | `{}`                                                                                         |    no    |
| <a name="input_service_subnets"></a> [service_subnets](#input_service_subnets)                                                       | A list of subnets in which the ECS service for will be deployed                                                                                                                                                                                                                                 | `list(string)` | n/a                                                                                          |   yes    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                        | A map of tags to add to all resources                                                                                                                                                                                                                                                           | `map(string)`  | `{}`                                                                                         |    no    |
| <a name="input_text_generation_inference"></a> [text_generation_inference](#input_text_generation_inference)                         | Map of values passed to TextGenerationInference container definition. See the [ECS container definition module](https://github.com/terraform-aws-modules/terraform-aws-ecs/tree/master/modules/container-definition) for full list of arguments supported                                       | `any`          | `{}`                                                                                         |    no    |
| <a name="input_text_generation_inference_gid"></a> [text_generation_inference_gid](#input_text_generation_inference_gid)             | GID of the text_generation_inference user                                                                                                                                                                                                                                                       | `number`       | `1000`                                                                                       |    no    |
| <a name="input_text_generation_inference_uid"></a> [text_generation_inference_uid](#input_text_generation_inference_uid)             | UID of the text_generation_inference user                                                                                                                                                                                                                                                       | `number`       | `100`                                                                                        |    no    |
| <a name="input_text_generation_inference_version"></a> [text_generation_inference_version](#input_text_generation_inference_version) | Version of the Text Generation Inference image to use                                                                                                                                                                                                                                           | `string`       | `"latest"`                                                                                   |    no    |
| <a name="input_use_spot_instances"></a> [use_spot_instances](#input_use_spot_instances)                                              | Determines whether to use spot instances for the ECS autoscaling group                                                                                                                                                                                                                          | `bool`         | `false`                                                                                      |    no    |
| <a name="input_validate_certificate"></a> [validate_certificate](#input_validate_certificate)                                        | Determines whether to validate ACM certificate using Route53 DNS. If false, certificate will be created but not validated                                                                                                                                                                       | `bool`         | `true`                                                                                       |    no    |
| <a name="input_vpc_id"></a> [vpc_id](#input_vpc_id)                                                                                  | ID of the VPC in which the resources will be created                                                                                                                                                                                                                                            | `string`       | n/a                                                                                          |   yes    |

## Outputs

| Name                                                                                                                       | Description |
| -------------------------------------------------------------------------------------------------------------------------- | ----------- |
| <a name="output_cluster_arn"></a> [cluster_arn](#output_cluster_arn)                                                       | n/a         |
| <a name="output_ecs_service_security_group_id"></a> [ecs_service_security_group_id](#output_ecs_service_security_group_id) | n/a         |
| <a name="output_service_name"></a> [service_name](#output_service_name)                                                    | n/a         |

<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
